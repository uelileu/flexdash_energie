---
title: "Energie"
output: 
  flexdashboard::flex_dashboard:
    theme: journal
    source_code: embed 
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(tidyverse)
library(plotly)
library(leaflet)
library(sf)
library(tmap)

```

Biogas
=======================================================================

### Karte der Biogasanlagen

```{r}
biog <- read_sf("data/BiogasPlants.gpkg", layer="BiogasPlant") %>% 
  st_transform(4326) %>% 
  mutate(CombinedHeatAndPower = as.numeric(CombinedHeatAndPower))
  
leaflet(biog) %>% 
  addTiles(attribution = "Quelle: Bundesamt für Energie") %>% 
  addCircleMarkers(color = "green", 
                   radius = ifelse(!is.na(biog$CombinedHeatAndPower),biog$CombinedHeatAndPower %>% log(base = 1.8),1),
                   fill = T,
                   fillOpacity = 0.1,
                   opacity = 0.7,
                   popup = paste0("Betreiber: ", biog$Name,"<br>",
                                  "In Betrieb seit: ", biog$BeginningOfOperation, "<br>",
                                  "Leistung kombiniert: ", round(biog$CombinedHeatAndPower,1)))
```

Windenergie
=======================================================================

### Karte des Windenergiepotentials und der bereits erstellten Windenergieanlagen

```{r}
windpot <- terra::rast("data/rastermap_v200605_einfarbig.tif") %>% terra::project("epsg:4326")
windanl <- read_sf("data/Windenergyplants.gpkg") %>% st_transform(4326) %>% 
  dplyr::filter(is.na(yearOfDismantling))


leaflet(windanl) %>% 
  addCircleMarkers(fill = F,
                   color = "brown",
                   radius = 1.5,
                   opacity = 0.8,
                   popup = paste0("Hersteller: ", windanl$manufacturer,"<br>",
                                  "Gebaut im Jahr ", windanl$yearOfConstruction, "<br>",
                                  "Richtwert Leistung: ", round(windanl$ratedPower,1))) %>% 
  addTiles(attribution = "Quelle: Bundesamt für Energie") %>% 
  addRasterImage(windpot %>% as(., "Raster"), 
                 colors = "chocolate1", 
                 opacity = 0.2)

```
